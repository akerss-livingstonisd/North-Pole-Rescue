<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>North Pole Map – Magic Lens</title>
<style>

body {
  margin: 0;
  padding: 0;
  background: #f3e8cc;
  font-family: "Comic Sans MS", "Comic Neue", sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#mapWrapper {
  background: #fdf7e3;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  padding: 16px 20px;
  box-sizing: border-box;
  max-width: 96vw;
}

#mapTitle {
  text-align: center;
  font-size: 24px;
  font-weight: bold;
  color: #b02727;
  margin-bottom: 6px;
}

#mapSubtitle {
  text-align: center;
  font-size: 14px;
  color: #6b5237;
  margin-bottom: 8px;
}

/* Map container */
#mapArea {
  position: relative;
  width: 900px;
  max-width: 92vw;
  aspect-ratio: 16 / 9;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.25);
  background: #0b2749;
}

#mapImage {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Hidden marker (gold star) */
#hiddenMarker {
  position: absolute;
  width: 26px;
  height: 26px;
  background: gold;
  clip-path: polygon(
    50% 0%, 61% 35%, 98% 35%,
    68% 57%, 79% 91%, 50% 70%,
    21% 91%, 32% 57%, 2% 35%, 
    39% 35%
  );
  transform: translate(-50%, -50%);
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
}

/* Marker location (percent of map) */
#hiddenMarker {
  top: 27%;
  left: 90%;
}

/* Red magic lens */
#lens {
  position: absolute;
  width: 75px;
  height: 75px;
  border-radius: 50%;
  border: 3px solid rgba(255,255,255,0.9);
  background: radial-gradient(circle,
              rgba(255, 0, 0, 0.35) 0%,
              rgba(180, 0, 0, 0.22) 60%,
              rgba(120, 0, 0, 0.12) 100%);
  box-shadow: 0 0 12px rgba(0,0,0,0.6);
  cursor: grab;
  /* IMPORTANT: no translate here – we use raw left/top in map coords */
  transform: none;
  z-index: 2;
}

#lens.dragging {
  cursor: grabbing;
}

#infoBox {
  margin-top: 8px;
  font-size: 14px;
  color: #4e3b28;
  background: rgba(255,255,255,0.9);
  border-radius: 10px;
  padding: 8px 10px;
  min-height: 40px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

/* ⭐ Twinkle animation for revealed marker */
@keyframes twinkle {
  0%   { transform: translate(-50%, -50%) scale(1)   rotate(0deg); }
  50%  { transform: translate(-50%, -50%) scale(1.25) rotate(12deg); }
  100% { transform: translate(-50%, -50%) scale(1)   rotate(0deg); }
}

#hiddenMarker.revealed {
  animation: twinkle 1s infinite;
}

#nextPuzzleBtn {
  margin-top: 10px;
  padding: 8px 16px;
  font-size: 14px;
  border-radius: 8px;
  border: none;
  background: #a83232;
  color: #fff;
  cursor: pointer;
  box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
}

#nextPuzzleBtn:hover {
  background: #7d2525;
}

</style>
</head>
<body>

<div id="mapWrapper">
  <div id="mapTitle">North Pole – Elf Toy Supply Map</div>
  <div id="mapSubtitle">Let Rudolph help you find where we should look next.</div>

  <div id="mapArea">
    <!-- Your map image -->
    <img id="mapImage" src="elf map.jpg" alt="North Pole Map">

    <!-- Hidden marker (revealed only when lens passes over it) -->
    <div id="hiddenMarker"></div>

    <!-- Movable filter lens -->
    <div id="lens"></div>
  </div>

  <div id="infoBox">
    Tip: When the hidden marker is inside the glowing lens, it will appear!
  </div>
<button id="nextPuzzleBtn" style="display:none;">
    Travel to the Island of Misfit Toys
  </button>
</div>

<script>
  const mapArea = document.getElementById("mapArea");
  const lens = document.getElementById("lens");
  const marker = document.getElementById("hiddenMarker");
  const infoBox = document.getElementById("infoBox");
  const nextPuzzleBtn = document.getElementById("nextPuzzleBtn");

  let isDragging = false;
  let offsetX = 0;
  let offsetY = 0;
  let starFound = false;

  // Place lens initially in the center of the map area (map-local coords)
  function centerLens() {
    const rect = mapArea.getBoundingClientRect();
    const lensRect = lens.getBoundingClientRect();

    const left = (rect.width - lensRect.width) / 2;
    const top  = (rect.height - lensRect.height) / 2;

    lens.style.left = left + "px";
    lens.style.top  = top + "px";

    updateReveal();
  }

  // Start dragging
  lens.addEventListener("mousedown", (e) => {
    isDragging = true;
    lens.classList.add("dragging");

    const lensRect = lens.getBoundingClientRect();
    offsetX = e.clientX - lensRect.left;
    offsetY = e.clientY - lensRect.top;

    document.addEventListener("mousemove", onDrag);
    document.addEventListener("mouseup", stopDrag);
  });

  function onDrag(e) {
    if (!isDragging) return;

    const mapRect = mapArea.getBoundingClientRect();
    const lensRect = lens.getBoundingClientRect();

    // Compute new position relative to mapArea
    let newLeft = e.clientX - mapRect.left - offsetX;
    let newTop  = e.clientY - mapRect.top  - offsetY;

    // Bounds inside mapArea
    const maxLeft = mapRect.width - lensRect.width;
    const maxTop  = mapRect.height - lensRect.height;

    if (newLeft < 0) newLeft = 0;
    if (newLeft > maxLeft) newLeft = maxLeft;
    if (newTop < 0) newTop = 0;
    if (newTop > maxTop) newTop = maxTop;

    lens.style.left = newLeft + "px";
    lens.style.top  = newTop + "px";

    updateReveal();
  }

  function stopDrag() {
    isDragging = false;
    lens.classList.remove("dragging");
    document.removeEventListener("mousemove", onDrag);
    document.removeEventListener("mouseup", stopDrag);
  }

    // Check if marker is inside the lens
  function updateReveal() {
    const lensRect = lens.getBoundingClientRect();
    const markerRect = marker.getBoundingClientRect();

    const lensCenterX = lensRect.left + lensRect.width / 2;
    const lensCenterY = lensRect.top  + lensRect.height / 2;

    const markerCenterX = markerRect.left + markerRect.width / 2;
    const markerCenterY = markerRect.top  + markerRect.height / 2;

    const dx = lensCenterX - markerCenterX;
    const dy = lensCenterY - markerCenterY;
    const distance = Math.sqrt(dx * dx + dy * dy);

    const lensRadius = lensRect.width / 2;

    if (distance <= lensRadius) {
      marker.style.opacity = 1;
      marker.classList.add("revealed");

      if (!starFound) {
        starFound = true;
        infoBox.textContent = "The Island of Misfit Toys! Great idea!";
        nextPuzzleBtn.style.display = "inline-block";
      }
    } else if (!starFound) {
      // Only reset before they solve it
      marker.style.opacity = 0;
      marker.classList.remove("revealed");
      infoBox.textContent = "Let Rudolph help you find where we should look next.";
    }
  }


  // Initialize after layout
  window.addEventListener("load", centerLens);
  window.addEventListener("resize", centerLens);

  nextPuzzleBtn.addEventListener("click", () => {
    window.location.href = "Misfits.html";
  });

</script>

</body>
</html>
